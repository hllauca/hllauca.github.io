{"title":"How to calibrate hydrological models?","markdown":{"yaml":{"title":"How to calibrate hydrological models?","description":"Bases for modeling hydrological systems and obtain reliable simulations","author":[{"name":"Harold Llauca","url":"https://hllauca.github.io/","orcid":"0000-0001-7462-2548"}],"date":"06-12-2023","categories":["Hydrological Modeling","Data-Science","R programming"],"citation":{"url":"https://hllauca.github.io/posts/2023-06-12-quarto-blogs/"},"image":"calibration.jpeg","draft":false,"filters":["social-share"],"share":{"permalink":"https://hllauca.github.io/posts/2023-06-12-quarto-blogs/","description":"How to calibrate hydrological models?","twitter":true,"facebook":true,"reddit":true,"linkedin":true,"email":true}},"headingText":"Model optimization","containsRefs":false,"markdown":"\n\nModels aim to represent hydrological systems using different kinds of mathematical simplifications (e.g. physical-based, conceptual, empirical) or spatial discretization approaches (distributed, semi-distributed, lumped). These models are capable of anticipating system response (e.g. in terms of water discharges) from forcing changes (e.g. precipitation). However, system uncertainties are implicit in the model from different sources such as: model forcings (u), parameters (θ), states (X), structure (M), or outputs (Y); as described by Liu & Gupta (2011). What is more, model errors ($\\varepsilon$) directly impact streamflow simulation due to propagation throw the model system - from inputs to outputs - as is shown in the following equation, where *t* is the time:\\\n $$\nY_{t} = M(u_{t},X_{t-1},θ, \\varepsilon)\n$$\n\n\\\nIn that context, model calibration techniques help to reduce parameter uncertainties and improve the streamflow representation.\\\n\n------------------------------------------------------------------------\n\n\nThe main focus of the model optimization procedure is to reduce errors between observed and simulated responses of the hydrological system throw parameter modification as described by Vrugt et al. (2013).\n\n![Schematic overview of the model calibration problem. Source: Vrugt et al. (2013).](images/system.PNG){width=\"600\"}\n\n\\\nThis objective might be explained by a **minimization problem**, where the cost function *J* represents errors between simulations (*Ysim*) and observations (*Yobs*):\\\n\\\n$$\nminJ = \\varepsilon_{(Ysim - Yobs)}\n$$\n\n\\\nThe cost function is commonly named the **Objective Function** (*OF*) and *J* might be expressed in terms of some statistical metrics such as the Root Mean Square Error (*RMSE*), where *n* represent the length of the time series and *i* is the time step.\\\n \n\n$$\nminOF = minRMSE = min(\\sqrt{\\frac{1}{n}\\sum_{i}^{n}\\left ( Y_{sim,i} - Y_{obs,i} \\right )^2})\n$$\n\n\\\nThere are other statistical metrics used in model calibration such as the popular Nash-Sutcliffe (*NSE*) or the Kling and Gupta (*KGE*) efficiency criterion. In both cases, higher values near 1 indicate a very good adjustment of simulations to observations, so the *OF* should be expressed as a maximization problem or a minimization problem of the negative metrics as follows:\\\n  $$\nmaxNSE = min(-1*NSE) = min(\\frac{\\sum_{i=1}^{n}(Y_{sim,i}-Y_{obs,i})^2}{\\sum_{i=1}^{n}(Y_{obs,i}-\\bar{Y_{obs}})^2})\n$$\\\n\n$$\nmaxKGE = min(-1*KGE) = min(\\sqrt{(r-1)^2+(\\frac{\\sigma _{sim}}{\\sigma _{obs}}-1)^2+(\\frac{\\mu _{sim}}{\\mu _{obs}}-1)^2})\n$$\n\n\\\nStatistical metrics help to quantify the agreements between observed and calculated discharges. For example, Ferreira et al. (2020) evaluate 36 OF proposed in the literature and confirm that each metric should be interpreted specifically thinking about the aspects it has been proposed for (e.g. such as for low-flows, high-flows, etc). Also, a set of goodness-of-fit functions for comparison of simulated and observed hydrological time series could be found in the [hydroGOF](https://cran.r-project.org/web/packages/hydroGOF/index.html) R package.\n\nMono-objective methods solve an optimization problem with a unique objective function as shown above. Hence, they might contain more than one metric using a linear expression of metrics and weights:\\\n \n\n$$\nminOF = a*RMSE - b*NSE - c*KGE\n$$\n\n\\\nAlso, multi-objective optimizations have been tested in hydrological modeling calibration to include more than a unique objective function with a Pareto optimization approach. For instance, Yeste et al. (2023) compare multi- and mono-objective calibration algorithms to integrate streamflow (Q) and evaporation (E) data in hydrological modeling.\n\n![Multi-objective calibration. Source: Yeste et al. (2023).](images/multiobjective-01.PNG){width=\"400\"}\n\n------------------------------------------------------------------------\n\n### Optimization algorithms\n\nSearching for the set of optimal model parameters might be an overwhelming task. The Shuffle Complex Evolutionary (SCE) algorithm is one of the most popular functions for mono-objective and global automatic calibration of hydrological model parameters. According to Duan et al. (1993), the SCE method is based on a synthesis of four concepts that have proved successful for global optimization: (a) combination of probabilistic and deterministic approaches; (b) clustering; (c) systematic evolution of a complex of points spanning the space, in the direction of global improvement; and (d) competitive evolution.\n\nThe following list presents some functions and packages available in the R language programming for the optimization of hydrological models:\n\n-   [sceua](https://www.rdocumentation.org/packages/rtop/versions/0.6-6/topics/sceua): Mono-objective calibration function using the Shuffle Complex Evolutionary (SCE) algorithm.\n\n-   [hydroPSO](https://www.rdocumentation.org/packages/hydroPSO/versions/0.3-1-1/topics/hydroPSO): Enhanced Particle Swarm Optimisation (PSO) algorithm.\n\n-   [ga](https://www.rdocumentation.org/packages/GA/versions/3.2.3/topics/ga): Maximization of a fitness function using Genetic Algorithms (GA).\n\n-   [dream](https://r-forge.r-project.org/projects/dream): DiffeRential Evolution Adaptive Metropolis (DREAM). Efficient global MCMC even in high-dimensional spaces.\n\n-   [nsga2R](https://www.rdocumentation.org/packages/nsga2R/versions/1.1/topics/nsga2R): Multi-objective calibration with the R Based Non-dominated Sorting Genetic Algorithm II.\n\n-   [rmoo](https://cran.r-project.org/web/packages/rmoo/index.html): Framework for multi- and many-objective optimization, which allows researchers and users versatility in parameter configuration, as well as tools for analysis, replication, and visualization of results.\n\n-   [caRamel](https://github.com/fzao/caRamel): R package for optimization implementing a multiobjective evolutionary algorithm combining the MEAS algorithm and the NGSA-II algorithm.\n\n-   [GPareto](https://cran.r-project.org/web/packages/GPareto/index.html): Multi-objective Expected Improvement and Step-wise Uncertainty Reduction sequential infill criteria.\\\n    \\\n\n------------------------------------------------------------------------\n\n### Calibration or validation?\n\nHydrological models require the development of two main steps before their operation. The **calibration** step consists of the selection of a window period where optimal model parameters are identified throw the procedure described lines above, while the **validation** step is about the use of these optimal parameters set in a new non-tested time window. In that sense, the assessment of model performance - using different statistical metrics - is computed during calibration and validation periods.\\\n\n![Calibrated and validated streamflow time series in a lumped hydrological model.](images/model_calib.PNG){fig-align=\"center\" width=\"500\"}\n\nThe **warm-up** period is a previous step inside the model calibration used to reduce initial condition uncertainties. For instance, in daily models, the first-year calibration model period is discarded from the OF and statistical performance metrics to make model outputs independent from initial model states.\\\n\n------------------------------------------------------------------------\n\n### References\n\nDuan, Q. Y., V. K. Gupta, and S. Sorooshian. 1993. \"Shuffled Complex Evolution Approach for Effective and Efficient Global Minimization.\" *Journal of Optimization Theory and Applications* 76 (3): 501--21. <https://doi.org/10.1007/BF00939380>.\n\nFerreira, Paloma Mara de Lima, Adriano Rolim da Paz, and Juan Martín Bravo. 2020. \"Objective Functions Used as Performance Metrics for Hydrological Models: State-of-the-Art and Critical Analysis.\" *RBRH* 25. <https://doi.org/10.1590/2318-0331.252020190155>.\n\nLiu, Yuqiong, and Hoshin V. Gupta. 2007. \"Uncertainty in Hydrologic Modeling: Toward an Integrated Data Assimilation Framework.\" *Water Resources Research* 43 (7): 160. <https://doi.org/10.1029/2006WR005756>.\n\nVrugt, Jasper A., Cajo J. F. ter Braak, Cees G. H. Diks, and Gerrit Schoups. 2013. \"Hydrologic Data Assimilation Using Particle Markov Chain Monte Carlo Simulation: Theory, Concepts and Applications.\" *Advances in Water Resources* 51 (January): 457--78. <https://doi.org/10.1016/j.advwatres.2012.04.002>.\n\nYeste, Patricio, Lieke A. Melsen, Matilde García-Valdecasas Ojeda, Sonia R. Gámiz-Fortis, Yolanda Castro-Díez, and María Jesús Esteban-Parra. 2023. \"A Pareto‐based Sensitivity Analysis and Multiobjective Calibration Approach for Integrating Streamflow and Evaporation Data.\" *Water Resources Research* 59 (6). <https://doi.org/10.1029/2022wr033235>.\n\n\\\n","srcMarkdownNoYaml":"\n\nModels aim to represent hydrological systems using different kinds of mathematical simplifications (e.g. physical-based, conceptual, empirical) or spatial discretization approaches (distributed, semi-distributed, lumped). These models are capable of anticipating system response (e.g. in terms of water discharges) from forcing changes (e.g. precipitation). However, system uncertainties are implicit in the model from different sources such as: model forcings (u), parameters (θ), states (X), structure (M), or outputs (Y); as described by Liu & Gupta (2011). What is more, model errors ($\\varepsilon$) directly impact streamflow simulation due to propagation throw the model system - from inputs to outputs - as is shown in the following equation, where *t* is the time:\\\n $$\nY_{t} = M(u_{t},X_{t-1},θ, \\varepsilon)\n$$\n\n\\\nIn that context, model calibration techniques help to reduce parameter uncertainties and improve the streamflow representation.\\\n\n------------------------------------------------------------------------\n\n### Model optimization\n\nThe main focus of the model optimization procedure is to reduce errors between observed and simulated responses of the hydrological system throw parameter modification as described by Vrugt et al. (2013).\n\n![Schematic overview of the model calibration problem. Source: Vrugt et al. (2013).](images/system.PNG){width=\"600\"}\n\n\\\nThis objective might be explained by a **minimization problem**, where the cost function *J* represents errors between simulations (*Ysim*) and observations (*Yobs*):\\\n\\\n$$\nminJ = \\varepsilon_{(Ysim - Yobs)}\n$$\n\n\\\nThe cost function is commonly named the **Objective Function** (*OF*) and *J* might be expressed in terms of some statistical metrics such as the Root Mean Square Error (*RMSE*), where *n* represent the length of the time series and *i* is the time step.\\\n \n\n$$\nminOF = minRMSE = min(\\sqrt{\\frac{1}{n}\\sum_{i}^{n}\\left ( Y_{sim,i} - Y_{obs,i} \\right )^2})\n$$\n\n\\\nThere are other statistical metrics used in model calibration such as the popular Nash-Sutcliffe (*NSE*) or the Kling and Gupta (*KGE*) efficiency criterion. In both cases, higher values near 1 indicate a very good adjustment of simulations to observations, so the *OF* should be expressed as a maximization problem or a minimization problem of the negative metrics as follows:\\\n  $$\nmaxNSE = min(-1*NSE) = min(\\frac{\\sum_{i=1}^{n}(Y_{sim,i}-Y_{obs,i})^2}{\\sum_{i=1}^{n}(Y_{obs,i}-\\bar{Y_{obs}})^2})\n$$\\\n\n$$\nmaxKGE = min(-1*KGE) = min(\\sqrt{(r-1)^2+(\\frac{\\sigma _{sim}}{\\sigma _{obs}}-1)^2+(\\frac{\\mu _{sim}}{\\mu _{obs}}-1)^2})\n$$\n\n\\\nStatistical metrics help to quantify the agreements between observed and calculated discharges. For example, Ferreira et al. (2020) evaluate 36 OF proposed in the literature and confirm that each metric should be interpreted specifically thinking about the aspects it has been proposed for (e.g. such as for low-flows, high-flows, etc). Also, a set of goodness-of-fit functions for comparison of simulated and observed hydrological time series could be found in the [hydroGOF](https://cran.r-project.org/web/packages/hydroGOF/index.html) R package.\n\nMono-objective methods solve an optimization problem with a unique objective function as shown above. Hence, they might contain more than one metric using a linear expression of metrics and weights:\\\n \n\n$$\nminOF = a*RMSE - b*NSE - c*KGE\n$$\n\n\\\nAlso, multi-objective optimizations have been tested in hydrological modeling calibration to include more than a unique objective function with a Pareto optimization approach. For instance, Yeste et al. (2023) compare multi- and mono-objective calibration algorithms to integrate streamflow (Q) and evaporation (E) data in hydrological modeling.\n\n![Multi-objective calibration. Source: Yeste et al. (2023).](images/multiobjective-01.PNG){width=\"400\"}\n\n------------------------------------------------------------------------\n\n### Optimization algorithms\n\nSearching for the set of optimal model parameters might be an overwhelming task. The Shuffle Complex Evolutionary (SCE) algorithm is one of the most popular functions for mono-objective and global automatic calibration of hydrological model parameters. According to Duan et al. (1993), the SCE method is based on a synthesis of four concepts that have proved successful for global optimization: (a) combination of probabilistic and deterministic approaches; (b) clustering; (c) systematic evolution of a complex of points spanning the space, in the direction of global improvement; and (d) competitive evolution.\n\nThe following list presents some functions and packages available in the R language programming for the optimization of hydrological models:\n\n-   [sceua](https://www.rdocumentation.org/packages/rtop/versions/0.6-6/topics/sceua): Mono-objective calibration function using the Shuffle Complex Evolutionary (SCE) algorithm.\n\n-   [hydroPSO](https://www.rdocumentation.org/packages/hydroPSO/versions/0.3-1-1/topics/hydroPSO): Enhanced Particle Swarm Optimisation (PSO) algorithm.\n\n-   [ga](https://www.rdocumentation.org/packages/GA/versions/3.2.3/topics/ga): Maximization of a fitness function using Genetic Algorithms (GA).\n\n-   [dream](https://r-forge.r-project.org/projects/dream): DiffeRential Evolution Adaptive Metropolis (DREAM). Efficient global MCMC even in high-dimensional spaces.\n\n-   [nsga2R](https://www.rdocumentation.org/packages/nsga2R/versions/1.1/topics/nsga2R): Multi-objective calibration with the R Based Non-dominated Sorting Genetic Algorithm II.\n\n-   [rmoo](https://cran.r-project.org/web/packages/rmoo/index.html): Framework for multi- and many-objective optimization, which allows researchers and users versatility in parameter configuration, as well as tools for analysis, replication, and visualization of results.\n\n-   [caRamel](https://github.com/fzao/caRamel): R package for optimization implementing a multiobjective evolutionary algorithm combining the MEAS algorithm and the NGSA-II algorithm.\n\n-   [GPareto](https://cran.r-project.org/web/packages/GPareto/index.html): Multi-objective Expected Improvement and Step-wise Uncertainty Reduction sequential infill criteria.\\\n    \\\n\n------------------------------------------------------------------------\n\n### Calibration or validation?\n\nHydrological models require the development of two main steps before their operation. The **calibration** step consists of the selection of a window period where optimal model parameters are identified throw the procedure described lines above, while the **validation** step is about the use of these optimal parameters set in a new non-tested time window. In that sense, the assessment of model performance - using different statistical metrics - is computed during calibration and validation periods.\\\n\n![Calibrated and validated streamflow time series in a lumped hydrological model.](images/model_calib.PNG){fig-align=\"center\" width=\"500\"}\n\nThe **warm-up** period is a previous step inside the model calibration used to reduce initial condition uncertainties. For instance, in daily models, the first-year calibration model period is discarded from the OF and statistical performance metrics to make model outputs independent from initial model states.\\\n\n------------------------------------------------------------------------\n\n### References\n\nDuan, Q. Y., V. K. Gupta, and S. Sorooshian. 1993. \"Shuffled Complex Evolution Approach for Effective and Efficient Global Minimization.\" *Journal of Optimization Theory and Applications* 76 (3): 501--21. <https://doi.org/10.1007/BF00939380>.\n\nFerreira, Paloma Mara de Lima, Adriano Rolim da Paz, and Juan Martín Bravo. 2020. \"Objective Functions Used as Performance Metrics for Hydrological Models: State-of-the-Art and Critical Analysis.\" *RBRH* 25. <https://doi.org/10.1590/2318-0331.252020190155>.\n\nLiu, Yuqiong, and Hoshin V. Gupta. 2007. \"Uncertainty in Hydrologic Modeling: Toward an Integrated Data Assimilation Framework.\" *Water Resources Research* 43 (7): 160. <https://doi.org/10.1029/2006WR005756>.\n\nVrugt, Jasper A., Cajo J. F. ter Braak, Cees G. H. Diks, and Gerrit Schoups. 2013. \"Hydrologic Data Assimilation Using Particle Markov Chain Monte Carlo Simulation: Theory, Concepts and Applications.\" *Advances in Water Resources* 51 (January): 457--78. <https://doi.org/10.1016/j.advwatres.2012.04.002>.\n\nYeste, Patricio, Lieke A. Melsen, Matilde García-Valdecasas Ojeda, Sonia R. Gámiz-Fortis, Yolanda Castro-Díez, and María Jesús Esteban-Parra. 2023. \"A Pareto‐based Sensitivity Analysis and Multiobjective Calibration Approach for Integrating Streamflow and Evaporation Data.\" *Water Resources Research* 59 (6). <https://doi.org/10.1029/2022wr033235>.\n\n\\\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"include-after-body":["../../_layouts/footer.html"],"filters":["social-share"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.313","editor":"visual","theme":"sandstone","title-block-banner":true,"title":"How to calibrate hydrological models?","description":"Bases for modeling hydrological systems and obtain reliable simulations","author":[{"name":"Harold Llauca","url":"https://hllauca.github.io/","orcid":"0000-0001-7462-2548"}],"date":"06-12-2023","categories":["Hydrological Modeling","Data-Science","R programming"],"citation":{"url":"https://hllauca.github.io/posts/2023-06-12-quarto-blogs/"},"image":"calibration.jpeg","draft":false,"share":{"permalink":"https://hllauca.github.io/posts/2023-06-12-quarto-blogs/","description":"How to calibrate hydrological models?","twitter":true,"facebook":true,"reddit":true,"linkedin":true,"email":true}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}